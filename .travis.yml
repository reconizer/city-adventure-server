language: elixir
elixir:
  - 1.7.4
otp_release:
  - 21.2.2
before_install:
  - ./scripts/travis/before-install.sh
before_script:
  - ./scripts/travis/before-script.sh
services:
  - postgresql

cache:
  directories:
    - _build
    - deps

addons:
  postgresql: "10"
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
    - postgresql-10-postgis-2.4
  s3_region: "eu-west-1"
  artifacts:
    region: "eu-west-1"
    paths:
      - ./app.tar.gz
    target_paths:
      - unfold-server/$TRAVIS_BRANCH/latest
      - unfold-server/$TRAVIS_BRANCH/builds/$TRAVIS_BUILD_NUMBER

script:
  - ./scripts/travis/test.sh

after_success:
  - ./scripts/travis/deploy.sh

env:
  global:
  - PGPORT=5433
  - MIX_ENV=test
  - DATABASE_PORT=5433
  - DATABASE_NAME=city_adventure_test
  - DATABASE_USER=postgres
  - DATABASE_PASSWORD=postgres
  - DATABASE_HOST=localhost